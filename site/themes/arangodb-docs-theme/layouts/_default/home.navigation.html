<ol class="main-nav-ol">
  {{- template "main-nav-tree" dict "Pages" .Site.Sections }}
</ol>

{{- define "main-nav-tree" }}
  {{- $pages := .Pages }}
  {{- range $page := $pages.ByWeight }}
    {{- if $page.Pages }}
      {{- /* section (with child pages) */}}
      <li class="nav-section">
        <div class="nav-section-header">
          <a class="link-nav" href="{{ .RelPermalink }}">{{ .Params.menuTitle | markdownify }}</a>
          <label class="expand-nav"><input type="checkbox"></label>
        </div>
        {{- $isVersioned := eq $page.RelPermalink "/arangodb/" }}
        {{ if $isVersioned }}
          {{- partial "version-selector.html" . }}
          {{- range $versionSection := $page.Pages }}
            <ol class="nav-ol" data-version="{{ index (split $versionSection.Path "/") 2 }}">
              {{- template "main-nav-tree" $versionSection -}}
            </ol>
          {{- end }}
        {{- else }}
          <ol class="nav-ol">
            {{- template "main-nav-tree" $page -}}
          </ol>
        {{- end }}
      </li>
    {{- else }}
      {{- /* page (or section without children) */}}
      <li class="nav-leaf">
        <a class="link-nav" href="{{ .RelPermalink }}">{{ .Params.menuTitle | markdownify }}</a>
      </li>
    {{- end }}
  {{- end }}
{{- end }}